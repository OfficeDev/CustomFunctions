<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
		<meta http-equiv="Expires" content="0" />
		<title>Custom Functions Upgrade Test</title>
		<script src="https://unpkg.com/@microsoft/office-js@1.1.33-custom.32/dist/office.debug.js" type="text/javascript"></script>
		<script src="custom-functions.js" type="text/javascript"></script>
		<script type="text/javascript">
			var g_sharedAppData = {};
			var g_BgAppRuntimeState = {};
            var g_BgAppRuntimeStartupState = {};

			function appCmdUpdateSharedAppData(event) {
				g_sharedAppData.value = 2019;
				event.completed();
			}

			function BtnReadData() {
				var txt = document.createTextNode(g_sharedAppData.value);
				var span = document.getElementById("SpanData");
				if (span.hasChildNodes()) {
					span.removeChild(span.childNodes[0]);
				}
				span.appendChild(txt);
			}

			function BtnSetData() {
				var value = document.getElementById("TxtData").value;
				if (!value) {
					value = 2019;
				}

				g_sharedAppData.value = value;
			}

			
            function BtnGetRuntimeState() {
				return promiseWorkaround(function () {
					return OfficeRuntime.currentRuntime.getState()
					.then(function (value) {
						var txt = document.createTextNode(value);
						var span = document.getElementById("SpanGetRtState");
						if (span.hasChildNodes()) {
							span.removeChild(span.childNodes[0]);
						}
						span.appendChild(txt);
						g_BgAppRuntimeState.value = value;
						return;
					})
					.catch(function (error) {
						return error.code;
					});
				});
            }

            function BtnSetRuntimeState() {
                var value = document.getElementById("TxtRtSetRtState").value;
                if (value) {
					 SetRuntimeStateHelper(value);
                }
            }
			
			function BtnGetStartupState() {
				return promiseWorkaround(function () {
					return OfficeRuntime.currentRuntime.getStartupState()
					.then(function (value) {
						var txt = document.createTextNode(value);
						var span = document.getElementById("SpanGetStartupState");
						if (span.hasChildNodes()) {
							span.removeChild(span.childNodes[0]);
						}
						span.appendChild(txt);
						g_BgAppRuntimeStartupState.value = value;
						return;
					})
					.catch(function (error) {
						return error.code;
					});
				});
            }

            function BtnSetStartupState() {
                var value = document.getElementById("TxtRtSetStartupState").value;
                if (value) {
					SetStartupStateHelper(value);
                }
            }
			
			function appCmdSetStateVisible(event) {
				SetRuntimeStateHelper("Visible");
				event.completed();   
			}
			
			function appCmdSetStateBackground(event) {
				SetRuntimeStateHelper("Background");
				event.completed();
            }
		</script>
	</head>
	<body>
		<div>
			<button id="BtnSetData" onclick="BtnSetData()">SetData</button>: <input id="TxtData" type="text" />
		</div>
		<div>
			<button id="BtnReadData" onclick="BtnReadData()">ReadData</button>: <span id="SpanData"></span>
		</div>
		<div>
			<button id="BtnSetRuntimeState" onclick="BtnSetRuntimeState()">BtnSetRtState</button>: <input id="TxtRtSetRtState" type="text" />
		</div>
		<div>
			<button id="BtnGetRuntimeState" onclick="BtnGetRuntimeState()">BtnGetRtState</button>: <span id="SpanGetRtState"></span>
		</div>
		 <div>
			<button id="BtnSetStartupState" onclick="BtnSetStartupState()">BtnSetStartupState</button>: <input id="TxtRtSetStartupState" type="text" />
		</div>
		<div>
			<button id="BtnGetStartupState" onclick="BtnGetStartupState()">BtnGetStartupState</button>: <span id="SpanGetStartupState"></span>
		</div>
	</body>
</html>
